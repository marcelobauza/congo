if @message
  wb = xlsx_package.workbook

  wb.add_worksheet(name: "Expedientes_Municipales") do |sheet|
    sheet.add_row ['Ha superado el limite m치ximo de Descargas']
  end
else
if current_user.role.name == 'IPRO+' || current_user.role.name == 'Admin' || current_user.role.name == 'MYPE'

wb = xlsx_package.workbook
wb.add_worksheet(name: "Compraventas") do |sheet|
  sheet.add_row [
    'X',
    'Y',
    'Tipo',
    'Direcci칩n',
    'Comuna',
    'Depto',
    'Plano',
    'Rol',
    'Foja',
    'Numero',
    'Fecha',
    'Comprador',
    'Tipo Vendedor',
    'Vendedor',
    'UF',
    'Est.',
    'Bod.',
    'sup.t_te',
    'Sup_l_cons',
    'uf_m2_u',
    'uf_m2_t',
    'Bimestre',
    'A침o',
    'Codigo Destino',
    'Codigo Material',
    'A침o Construccion',
    'Observaciones'
  ]
  @transaction.each do |row|
    sheet.add_row [
      row.the_geom.x,
      row.the_geom.y,
      row.property_type_name,
      row.address,
      row.county_name,
      row.department,
      row.blueprint,
      row.role,
      row.sheet,
      row.number,
      row.inscription_date,
      row.buyer_name,
      row.seller_type_name,
      row.seller_name,
      row.calculated_value,
      row.parkingi,
      row.cellar,
      row.total_surface_terrain,
      row.total_surface_building,
      row.uf_m2_u,
      row.uf_m2_t,
      row.bimester,
      row.year,
      row.code_destination,
      row.code_material,
      row.year_sii,
      row.comments
    ]
end
end
end
end
